flow:
  name: support_triage
  version: "1.0.0"
  description: "Triage support requests with branching logic based on issue type"
  initial_state: ask_issue_type
  
  states:
    ask_issue_type:
      type: question
      message:
        text: "What type of issue are you experiencing?"
        buttons:
          - label: "Technical Problem"
            value: "technical"
          - label: "Billing Question"
            value: "billing"
          - label: "Feature Request"
            value: "feature"
          - label: "Other"
            value: "other"
      metadata:
        progress: 0.2
    
    collect_technical_details:
      type: data_collection
      message: "Please describe the technical issue you're experiencing. Include any error messages or steps to reproduce."
      validation:
        required: true
        type: string
        min_length: 10
        max_length: 1000
        error_message: "Please provide at least 10 characters describing the issue"
      metadata:
        progress: 0.5
    
    collect_billing_info:
      type: data_collection
      message: "What is your account number or billing email address?"
      validation:
        required: true
        type: string
        min_length: 3
        error_message: "Please provide your account number or billing email"
      metadata:
        progress: 0.5
    
    collect_feature_details:
      type: data_collection
      message: "What feature would you like to see? Please describe how it would help you."
      validation:
        required: true
        type: string
        min_length: 20
        max_length: 500
        error_message: "Please provide at least 20 characters describing the feature"
      metadata:
        progress: 0.5
    
    collect_other_details:
      type: data_collection
      message: "Please describe your issue or question."
      validation:
        required: true
        type: string
        min_length: 5
        max_length: 500
        error_message: "Please provide at least 5 characters"
      metadata:
        progress: 0.5
    
    confirm_submission:
      type: confirmation
      message:
        text: "Please confirm your request:\n\nIssue Type: {{issue_type}}\nDetails: {{details}}\n\nSubmit this request?"
        buttons:
          - label: "Yes, submit"
            value: "yes"
          - label: "No, cancel"
            value: "no"
      metadata:
        progress: 0.8
    
    route_to_support:
      type: end
      message: "Thank you! Your request has been submitted. Our team will respond within 24 hours. Your ticket number is {{ticket_number}}."
      actions:
        - type: log_event
          event_type: "support_request_submitted"
          data:
            issue_type: "{{issue_type}}"
            details: "{{details}}"
            account_info: "{{account_info}}"
      metadata:
        progress: 1.0
    
    cancelled:
      type: end
      message: "Request cancelled. If you need help, please start a new request."
      metadata:
        progress: 1.0

  transitions:
    - from: ask_issue_type
      to: collect_technical_details
      condition:
        type: equals
        field: user_response
        value: "technical"
      actions:
        - type: set_field
          target: issue_type
          value: "technical"
    
    - from: ask_issue_type
      to: collect_billing_info
      condition:
        type: equals
        field: user_response
        value: "billing"
      actions:
        - type: set_field
          target: issue_type
          value: "billing"
    
    - from: ask_issue_type
      to: collect_feature_details
      condition:
        type: equals
        field: user_response
        value: "feature"
      actions:
        - type: set_field
          target: issue_type
          value: "feature"
    
    - from: ask_issue_type
      to: collect_other_details
      condition:
        type: equals
        field: user_response
        value: "other"
      actions:
        - type: set_field
          target: issue_type
          value: "other"
    
    - from: collect_technical_details
      to: confirm_submission
      condition:
        type: always
      actions:
        - type: set_field
          target: details
          value: "{{user_response}}"
    
    - from: collect_billing_info
      to: confirm_submission
      condition:
        type: always
      actions:
        - type: set_field
          target: account_info
          value: "{{user_response}}"
        - type: set_field
          target: details
          value: "{{user_response}}"
    
    - from: collect_feature_details
      to: confirm_submission
      condition:
        type: always
      actions:
        - type: set_field
          target: details
          value: "{{user_response}}"
    
    - from: collect_other_details
      to: confirm_submission
      condition:
        type: always
      actions:
        - type: set_field
          target: details
          value: "{{user_response}}"
    
    - from: confirm_submission
      to: route_to_support
      condition:
        type: equals
        field: user_response
        value: "yes"
      actions:
        - type: set_field
          target: ticket_number
          value: "TKT-{{random_number}}"
    
    - from: confirm_submission
      to: cancelled
      condition:
        type: equals
        field: user_response
        value: "no"
